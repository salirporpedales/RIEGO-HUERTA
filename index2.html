<div id="login-form" style="padding: 20px;">
    <input type="email" id="email" placeholder="Correo">
    <input type="password" id="pass" placeholder="Contraseña">
    <button onclick="login()" style="width: auto; padding: 10px 20px; background: #3498db; color: white;">Entrar</button>
</div>

<script>
    
 const firebaseConfig = {
	  apiKey: "AIzaSyD2QRDQ-QoxZ8GwgEonC0gQJ6CU6BG-Th4",
           authDomain: "riego-huerta.firebaseapp.com",
           databaseURL: "https://riego-huerta-default-rtdb.europe-west1.firebasedatabase.app",
           projectId: "riego-huerta",
          storageBucket: "riego-huerta.firebasestorage.app",
          messagingSenderId: "153931971594",
          appId: "1:153931971594:web:4c385921df852541c7f3f3"
	};
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    const container = document.getElementById('relay-container');
    const loginForm = document.getElementById('login-form');

    // Función para iniciar sesión
    function login() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('pass').value;
        auth.signInWithEmailAndPassword(email, pass).catch(e => alert(e.message));
    }

    // Observador de estado de sesión
    auth.onAuthStateChanged((user) => {
        if (user) {
            loginForm.style.display = 'none';
            container.style.display = 'grid';
            iniciarApp(); // Solo carga los datos si está logueado
        } else {
            loginForm.style.display = 'block';
            container.style.display = 'none';
        }
    });

    function iniciarApp() {
        // Generar botones (si no existen)
        container.innerHTML = "";
        for (let i = 1; i <= 8; i++) {
            container.innerHTML += `
                <div class="card">
                    <h3>Relé ${i}</h3>
                    <button id="btn${i}" onclick="toggleRelay(${i})" class="btn-off">Cargando...</button>
                </div>
            `;
        }

        // Escuchar cambios
        db.ref('reles').on('value', (snapshot) => {
            const data = snapshot.val();
            if(!data) return;
            for (let i = 1; i <= 8; i++) {
                const btn = document.getElementById(`btn${i}`);
                if(btn) {
                    const status = data[`r${i}`];
                    btn.innerText = status === 1 ? "ENCENDIDO" : "APAGADO";
                    btn.className = status === 1 ? "btn-on" : "btn-off";
                }
            }
        });
    }

    function toggleRelay(id) {
        const btn = document.getElementById(`btn${id}`);
        const newState = btn.className === "btn-off" ? 1 : 0;
        db.ref('reles/r' + id).set(newState);
    }
          </script>
